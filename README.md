### Распределенная система бронирования заказов

## Стек технологий

### Технологический стек

#### Языки программирования

Проект разработан с использованием двух основных языков программирования:
- **Java 17**: Основной язык программирования для разработки серверной части приложения.
- **Kotlin 1.8.10**: Используется для написания отдельных модулей и компонентов, обеспечивая лаконичность и безопасность кода.

#### Сборка и управление зависимостями

Для сборки проекта и управления зависимостями используется:
- **Maven**: Система управления проектами и сборки, обеспечивающая управление зависимостями и автоматизацию сборки.

#### Spring Framework

Для разработки и интеграции различных компонентов приложения используется Spring Framework:
- **Spring Cloud**: Набор инструментов для создания распределенных систем.
   - **Config Server**: Центральное хранилище конфигураций для всех микросервисов.
   - **Discovery Server (Eureka)**: Сервис для регистрации и обнаружения микросервисов.
   - **API Gateway Server**: Единая точка входа в систему, обеспечивающая маршрутизацию и безопасность.
- **Spring Boot**: Фреймворк для создания автономных, готовых к производству приложений на основе Spring.
- **Spring Data JPA**: Упрощает работу с базами данных, предоставляя абстракцию над JPA.
- **Spring Web**: Модуль для создания веб-приложений и RESTful сервисов.
- **Spring Security (JWT)**: Обеспечивает безопасность приложения с использованием JSON Web Tokens (JWT).
- **Spring Boot Actuator (Micrometer)**: Инструменты для мониторинга и управления приложением.

#### Интеграция и взаимодействие

Для взаимодействия между микросервисами и внешними системами используются следующие технологии:
- **Kafka**: Платформа потоковой передачи данных, используемая для обмена сообщениями между микросервисами.
- **Feign Client**: Упрощает создание HTTP-клиентов для взаимодействия с внешними API.
- **RestTemplate**: Синхронный клиент для выполнения HTTP-запросов.
- **MapStruct**: Инструмент для автоматического маппинга между объектами.

#### Базы данных

Для хранения данных используются следующие базы данных:
- **PostgreSQL**: Основная реляционная база данных для хранения данных приложения.
- **H2**: Встраиваемая база данных, используемая для тестирования и разработки.
- **Hibernate**: ORM-фреймворк для работы с базами данных.

#### Тестирование

Для обеспечения качества и надежности кода используются следующие инструменты тестирования:
- **Spring Boot Test**: Набор инструментов для тестирования Spring Boot приложений.
- **JUnit, Mockito**: Фреймворки для модульного тестирования и создания мок-объектов.

#### Мониторинг и визуализация

Для мониторинга состояния системы и визуализации метрик используются:
- **Prometheus**: Система мониторинга и сбора метрик.
- **Grafana**: Платформа для визуализации данных и создания дашбордов.

#### Circuit Breaker и Retry

## Компоненты приложения

1. **Config Service** - удаленный репозиторий для хранения конфигураций бизнес-сервисов.
2. **Eureka Server** - Service Discovery для регистрации основных сервисов приложения.
3. **Gateway Service** - сервис, единая точка входа в приложение (валидация JWT токена).
4. **Identity Service** - аутентификация и авторизация приложения.
5. **Booking Service** - сервис для обработки заказов на бронирование билетов с последующей передачей заказа в Ticket Service.
6. **Ticket Service** - сервис для обработки заказов на бронирование билетов, заполнение информации по заказу и отправка информации в Notification Service.
7. **Artist Service** - сервис, содержащий актуальную информацию о выступающих артистах.
8. **Notification Service** - сервис для отправки уведомлений клиенту о номере заказа.

## Информация о бизнес-компонентах приложения

1. **Booking Service** - принимает заказ от клиента, посредством Kafka брокера передает событие заказа в Ticket Service.
2. **Ticket Service** - принимает событие заказа от Booking Service, бронирует номер билета и место, обращается в Artist Service для заполнения информации по выступающему артисту, после чего отправляет запрос на отправку уведомления в Notification Service.
3. **Artist Service** - содержит данные о выступающих артистах и передает эти данные по запросу Ticket Service.
4. **Notification Service** - принимает запрос от Ticket Service и отправляет уведомление клиенту с основной информацией по заказу. Для определения вида уведомления (EMAIL, PUSH) применяется паттерн проектирования Стратегия.
5. **Identity Service** - выполняет функцию регистрации пользователя в приложении и выдачи ему JWT токена, а также аутентификации уже зарегистрированного пользователя с выдачей токена.

## Дополнительная информация

Сбор базовых и прикладных метрик организован с помощью Spring Boot Actuator (Micrometer), Java Annotation, Spring AOP. Поставка метрик в Prometheus, визуализация в Grafana. Сервисы развернуты в контейнерах с помощью Docker Compose.

## Коллекция запросов Postman

[postman-collection/Microservice.postman_collection.json](postman-collection/Microservice.postman_collection.json)
- Файл с запросами в корне проекта из IDE  [requests.http]

## Локальный запуск

1. Убедитесь, что у вас установлены следующие инструменты:
    - [Kafka](https://kafka.apache.org/quickstart)
    - [Docker](https://www.docker.com/get-started)
    - [Docker Compose](https://docs.docker.com/compose/install/)

2. Запускаем сервисы в соответствии с порядком инициализации конфигураций:
    - Config Service
    - Eureka Server
    - Artist Service
    - Ticket Service
    - Booking Service
    - Notification Service
    - Identity Service
    - Gateway Service

3. Выполните команду `docker-compose up` для запуска Prometheus и Grafana.

Prometheus: [http://localhost:9090](http://localhost:9090)  
Grafana: [http://localhost:4000](http://localhost:4000)

## Настройка Grafana

### Откройте Grafana:

1. Перейдите в браузере по адресу [http://localhost:4000](http://localhost:4000).
2. Войдите в систему с именем пользователя `admin` и паролем `admin`.

### Добавьте источник данных Prometheus:

1. Перейдите в "Configuration" -> "Data Sources".
2. Нажмите "Add data source".
3. Выберите "Prometheus".
4. В поле URL введите `http://prometheus:9090`.
5. Нажмите "Save & Test".

### Создайте дашборд:

1. Перейдите в "Create" -> "Dashboard".
2. Нажмите "Add new panel".
3. В поле "Metrics" введите `metric_name_requests_total`.
4. Настройте график по вашему усмотрению.
5. Сохраните дашборд.

### Пример конфигурации дашборда:

1. Добавление панели:
    - В поле "Query" введите `metric_name_requests_total_failure_total`.
    - Настройте визуализацию (например, график или счетчик).
2. Сохранение дашборда:
    - Нажмите "Save dashboard".
    - Дайте имя вашему дашборду и нажмите "Save".